function exit_prev_edit() {
    $new_comm.show(), $new_sucs.show(), $("textarea").each(function () {
        this.value = ""
    }), edit = ""
}

function wait_for() {
    wait > 0 ? ($submit.html('<div style="width:55px;"><i class="loading mr10"></i>' + wait + "</div>").attr("disabled", !0), wait--, setTimeout(wait_for, 1e3)) : ($submit.html($submit_html).attr("disabled", !1), wait = 15)
}

$comments = $("#comments-title"), $cancel = $("#cancel-comment-reply-link"), $author = $("#comment-user-info"), $submit = $("#commentform #submit"), $cancel = $("#cancel-comment-reply-link"), $com_ajax_url = _win.ajax_url, $com_list = $("#postcomments .commentlist"), _win.bd.on("click", ".commentlist .pagenav a,.comment-orderby", function () {
    var t = $(this);
    $("#cancel-comment-reply-link").click();
    var e = !t.attr("no-replace");
    return post_ajax($(this), ".commentlist", ".commentlist", ">.comment", "", ".pagenav", "", "", e)
}), _win.bd.on("click", ".comment-reply-link", function () {
    return _this = $(this), commentid = _this.attr("data-commentid"), addComment.moveForm("div-comment-" + commentid, commentid, "respond", _this.attr("data-postid")), scrollTo(_this, -100), !1
}), _win.bd.on("click", ".comment-edit-link", function () {
    return _this = $(this), commentid = _this.attr("data-commentid"), addComment.moveForm("div-comment-" + commentid, commentid, "respond", _this.attr("data-postid"), 1), scrollTo($("#div-comment-" + commentid), -100), !1
}), _win.bd.on("click", ".comment-trash-link", function () {
    var t = $(this), e = t.attr("data-commentid"), n = {action: "trash_comment", comment_id: e};
    1 == confirm("确认要删除此评论吗？") && zib_ajax(t, n, function (t) {
        t.error || $("#comment-" + e).slideUp().delay(1e3, function () {
            $(this).remove()
        })
    }, "正在获取内容...")
}), _win.bd.on("click", ".comment-approve-link", function () {
    var t = $(this), e = t.attr("data-commentid"), n = {action: "approve_comment", comment_id: e},
        m = $("#div-comment-" + e).find(".reply-link");
    zib_ajax(t, n, function (n) {
        if (!n.error) {
            var o = "hold" == n.status ? "批准" : "驳回", i = "hold" == n.status ? "approve" : "unapprove",
                a = "hold" == n.status ? '<span class="badg c-red badg-sm">待审核</span>' : "";
            "hold" == n.status ? m.remove() : m.length || t.parents(".dropdown").before('<span class="reply-link"><a class="comment-reply-link" data-commentid="' + e + '" href="javascript:;">回复</a></span>'), $("#div-comment-" + e).find(".badge-approve").html(a), t.removeClass("approve unapprove").addClass(i).find("text").html(o)
        }
    })
}), $("#commentform").submit(function () {
    var t = $(this), e = t.serializeObject();
    if ($author.length && $author.attr("require_name_email")) {
        if (e.author.length < 2 || e.email.length < 4) return notyf("请输入昵称和邮箱", "warning"), $author.addClass("open").find('[name="author"]').focus(), !1;
        if (!is_mail(e.email)) return notyf("邮箱格式错误", "warning"), $author.addClass("open").find('[name="email"]').focus(), !1
    }
    return e.comment.length < 6 ? (notyf("评论内容过少", "warning"), $("#comment").focus(), !1) : (e.action = "submit_comment", zib_ajax($submit, e, function (t) {
        var n = t.html;
        if (!t.error && n) {
            if (e.edit_comment_ID) $cancel.click(), $("#comment-" + e.edit_comment_ID).find(".comment-content").html(n); else {
                if (n = n.replace(/class="comment/, 'style="display:none;" class="comment ajax-comment'), n = 0 != e.comment_parent ? '<ul class="children">' + n + "</ul>" : n, respond = $("#respond"), $com_list = $("#postcomments .commentlist"), is_comment_parent = respond.parent().parent(".comment"), is_comment_parent.length) is_comment_parent.after(n); else if ($com_list.length) {
                    var m = $("#postcomments .commentlist>.comment-filter");
                    m.length ? m.after(n) : $com_list.prepend(n)
                } else respond.after('<div id="postcomments"><ol class="commentlist list-unstyled">' + n + "</ol></div>");
                $cancel.click(), $("#postcomments .ajax-comment").slideDown(200).removeClass("ajax-comment")
            }
            auto_fun(), wait_for(), $("#comment").val("")
        }
    }), !1)
});
var addComment = {
    moveForm: function (t, e, n, m, o) {
        var i, a = this, c = a.I(t), r = a.I(n), s = a.I("cancel-comment-reply-link"), l = a.I("comment_parent"),
            d = a.I("comment_post_ID");
        if ($(".comment-content,.comt-meta").show(), o) {
            a.I("comment").value = "", $("#comment_parent").attr("name", "edit_comment_ID"), $submit.attr("disabled", !0).html('<i class="loading mr6"></i><span>加载中</span>'), $("#comment").attr("disabled", !0), $("#" + t).find(".comment-content,.comt-meta").hide();
            var p = {action: "get_comment", comment_id: e};
            zib_ajax(_this, p, function (t) {
                t.error && $cancel.click(), $submit.html($submit_html).attr("disabled", !1), $("#comment").attr("disabled", !1).val(t.comment_content)
            }, "正在获取内容...")
        }
        a.respondId = n, m = m || !1, a.I("wp-temp-form-div") || (i = document.createElement("div"), i.id = "wp-temp-form-div", i.style.display = "none", r.parentNode.insertBefore(i, r)), c ? c.parentNode.insertBefore(r, c.nextSibling) : (temp = a.I("wp-temp-form-div"), a.I("comment_parent").value = "0", temp.parentNode.insertBefore(r, temp), temp.parentNode.removeChild(temp)), d && m && (d.value = m), l.value = e, s.style.display = "", s.onclick = function () {
            var t = addComment, e = t.I("wp-temp-form-div"), n = t.I(t.respondId);
            return $("#comment_parent").attr("name", "comment_parent"), t.I("comment_parent").value = "0", $(".comment-content,.comt-meta").show(), $("#comment").val(""), e && n && (e.parentNode.insertBefore(n, e), e.parentNode.removeChild(e)), this.style.display = "none", this.onclick = null, !1
        };
        try {
            a.I("comment").focus()
        } catch (t) {
        }
        return !1
    }, I: function (t) {
        return document.getElementById(t)
    }
}, wait = 15, $submit_html = $submit.html();